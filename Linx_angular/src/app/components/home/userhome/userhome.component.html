<div class="mt-5 ms-10">
  <p class="profilename">{{ isUser() ? (userdata?.account?.linxname ? userdata!.account.linxname : '') :
    (linxdata?.linxname ?
    linxdata!.linxname : '') }}</p>
</div>
<div class="homecontainer">

  <!--PERFIL | AVISOS | REPORTES || CHAT | LINX'S CHAIN-->
  @if(isUser()){
  <div class="leftSideLinks">
    <div>
      <a routerLink="/Linx/Home/Profile" routerLinkActive="active"
        class="flex flex-row text-cyan-400 hover:text-blue-700 pt-3">
        <span class="material-symbols-outlined">
          assignment_ind
        </span>
        <p class="ps-2 pt-1">Perfil</p>
      </a>
      <a routerLink="/Linx/Home/Avisos" routerLinkActive="active"
        class="flex flex-row text-yellow-300 hover:text-amber-700 pt-3">
        <span class="material-symbols-outlined">crisis_alert</span>
        <p class="ps-2">Avisos</p>
      </a>
      <a routerLink="/Linx/Home/Reportes" routerLinkActive="active"
        class="flex flex-row text-yellow-300 hover:text-yellow-500 pt-3">
        <span class="material-symbols-outlined">flag</span>
        <p class="ps-2">Reportes</p>
      </a>
    </div>
  </div>
  }@else {
  <div class="leftSideLinks">
    <div>
      <button (click)="toggleChatModal()" class="flex flex-row text-purple-400 hover:text-blue-700 pt-3">
        <span class="material-symbols-outlined">
          change_history
        </span>
        <p class="ps-2 pt-1 font-bold text-xl">Chat</p>
      </button>
      @if(isChained()){
      <button (click)="toggleExtChainModal()" class="flex flex-row text-green-400 hover:text-purple-500 pt-3">
        <span class="material-symbols-outlined">
          trip_origin
        </span>
        <p class="ps-2 pt-1 font-bold text-xl">Cadena</p>
      </button>
      <div class="chainbutt">
        <button (click)="showAlert('breakchain', true)" data-tooltip-target="tooltip-animation"
          data-tooltip-placement="right" data-tooltip-style="light"
          class="flex flex-row hover:bg-slate-100 p-3 rounded-md">
          <img style="width: 40px; height: auto;" src="../../../../assets/imgs/logos/breakchainbutt.png">
        </button>
        <div id="tooltip-animation" role="tooltip"
          class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-extralight text-black transition-opacity duration-300 rounded-lg shadow-sm opacity-0 tooltip ">
          Romper cadena
        </div>
      </div>
      }@else {
      <div class="joinchainbutt">
        <button [disabled]="isChainRequested()" (click)="showAlert('requestchain', true)"
          data-tooltip-target="tooltip-animation-2" data-tooltip-placement="right" data-tooltip-style="light"
          class="hover:bg-fuchsia-200 bg-fuchsia-100 border-fuchsia-400 p-3 rounded-md">
          <img style="width: 60px; height: auto;" src="../../../../assets/imgs/logos/joinchainbutt.png">
        </button>
        <div id="tooltip-animation-2" role="tooltip"
          class="absolute z-10 invisible inline-block px-3 py-2 text-sm font-extralight text-fuchsia-600 transition-opacity duration-300 rounded-lg shadow-sm opacity-0 tooltip ">
          {{ isChainRequested() ? "" : "Unir a tu cadena"}}
        </div>
      </div>
      }
    </div>
  </div>
  }
  <!--ASIDE mobile-->
  <div class="asidemobile">
    <app-userhomeaside></app-userhomeaside>
    @if(!isUser()){
    <div class="reportLink mt-5">
      <a routerLink="/Linx/Home/Reportes" routerLinkActive="active"
        class="flex flex-row text-yellow-500 hover:text-yellow-600">
        <span class="material-symbols-outlined">flag</span>
        <p class="ps-1 pt-2">Reportar</p>
      </a>
    </div>
    }
  </div>
  <!--ARTICULOS-->
  <div class="artsContainer">
    <div class="alertcontainer">
      @if(showJoinChainRequested()){
      <div class="joinalert">
        <button type="button" class="text-end text-gray-300" (click)="showAlert('requestchain', false)">
          <span class="material-symbols-outlined hover:text-gray-500 me-5">close</span>
        </button>
        <h3>¬ø Quieres solicitar a {{this.linxdata?.linxname}} unir vuestras cadenas ?</h3>
        <p>Al unir vuestras cadenas {{this.linxdata?.linxname}} tendr√° acceso a todxs tus linxs y t√∫ tendr√°s acceso a
          todxs lxs linxs de {{this.linxdata?.linxname}}</p>
        <div class="alertbuttcontainer">
          <button type="button" (click)="requestJoinChain()"
            class="alertbutt text-violet-400 bg-white border border-violet-300 hover:bg-violet-100 font-normal rounded-lg text-sm px-2 me-2 mb-2">
            Unir
          </button>
        </div>
      </div>
      }
      @if(isChainRequested() && !isChained()){
      <div class="joinalert">
        <h3>Hemos enviado tu solicitud a {{this.linxdata?.linxname}} ... quiz√°s el principio de una alucinante cadena de
          cadenas.</h3>
      </div>
      }
      @if(isChainBeingRequested() && !isUser()){
      <div class="joinreqalert">
        <h4>¬ø Aceptas la solicitud de {{this.linxdata?.linxname}} de unir vuestras cadenas ?</h4>
        <div class="flex flex-row justify-around">
          <button type="button" (click)="requestJoinChain()"
            class="alertbutt text-red-700 bg-white border border-red-600 hover:bg-red-100 font-normal rounded-lg text-sm px-2 me-2 mb-2 ">
            Rechazar
          </button>
          <button type="button" (click)="rejectJoinReq()"
            class="alertbutt text-violet-400 bg-white border border-violet-300 hover:bg-violet-100 font-normal rounded-lg text-sm px-2 me-2 mb-2">
            Unir cadenas
          </button>
        </div>
      </div>
      }
      @if (this.showBreakChainAlert()) {
        <div class="breakalert">
          <h4>Al romper cadena perder√°s a Calle y a todxs lxs linxs de su cadena , ¬øest√°s segurx de querer continuar?</h4>
          <div class="alertbuttcontainer">
            <button type="button" (click)="showAlert('breakchain', false)"
              class="alertbutt text-violet-400 bg-white border border-violet-300 hover:bg-violet-100 font-normal rounded-lg text-sm px-2 me-2 mb-2">
              Cancelar
            </button>
            <button type="button" (click)="breakChain()"
              class="alertbutt text-red-700 bg-white border border-red-600 hover:bg-red-100 font-normal rounded-lg text-sm px-2 me-2 mb-2 ">
              Romper cadena
            </button>
          </div>
        </div>
        }
    </div>

    @if(this.loadingArts()){
    <article role="status" class="animate-pulse">
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload w-2/3"></div>
    </article>
    <article role="status" class="animate-pulse">
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload w-2/3"></div>
    </article>
    <article role="status" class="animate-pulse">
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload w-2/3"></div>
    </article>
    <article role="status" class="animate-pulse">
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload"></div>
      <div class="animateload w-2/3"></div>
    </article>
    }@else {
    @for(art of this.articles; track $index){
    <article class="article">
      <h1>{{art.title}}</h1>
      <p style="color: gray;"><small>{{art.postedOn}}</small></p>
      <p class="break-words">{{art.body}}</p>
      <div class="artimg">
        <img style="max-width: 100%; max-height: 100%;" [src]="'http://localhost:3000/api/Account/uploads/'+art.img">
      </div>
      <div class="footart">
        @if(isUser()){
        <button type="button" (click)="toggleArtFormModal()" class="editart">
          <span class="material-symbols-outlined">
            edit
          </span>
        </button>
        }
      </div>
    </article>
    }@empty{
    @if(isUser()){
    <article class="article">
      <h1>Escribe tu primer art√≠culo</h1>
      <p style="color: gray;"><small>{{this.currentDate.toLocaleString()}}</small></p>
      <p>Escribe algo para que lxs dem√°s sepan qui√©n eres...qu√© est√°s buscando... o en qu√© piensas üëæ</p>
      <div class="flex justify-end">

        <button type="button" (click)="toggleArtFormModal()"
          class=" hover:text-orange-600 flex flex-row p-3 rounded-lg">
          <span class="material-symbols-outlined">
            edit
          </span>
        </button>
      </div>
    </article>
    }@else {
    <article class="noarticles">
      <span><img src="../../../../assets/imgs/bacteria/racimo_violeta.png" alt=""></span>
    </article>
    }
    }
    }

    <div class="addart">
      @if(isUser()){
      <button (click)="toggleArtFormModal()" type="button"
        class="bg-orange-500 hover:bg-orange-400 flex flex-row p-3 rounded-lg">
        <span class="material-symbols-outlined">
          note_add
        </span>
      </button>
      }
    </div>
  </div>

  <!--ASIDE mobile-->
  <div class="aside">
    <app-userhomeaside></app-userhomeaside>
    @if(!isUser()){
    <div class="reportLink">
      <a routerLink="/Linx/Home/Reportes" routerLinkActive="active"
        class="flex flex-row text-yellow-500 hover:text-yellow-600">
        <span class="material-symbols-outlined">flag</span>
        <p class="ps-1 pt-2">Reportar</p>
      </a>
    </div>
    }
  </div>
</div>

<app-articlemodalform [isOpen]="isArtFormOpen" [article]="article" [userdata]="userdata"
  (articleChange)="onArticleChange"></app-articlemodalform>

<!--CERRAR SESION | ROMPER CADENA-->
<div class="homefooter text-violet-300">
  @if(isUser()){
  <button (click)="logout()" class="ms-10 flex flex-row items-inline">
    <span class="material-symbols-outlined">
      meeting_room
    </span>
    <p class="pt-1 ps-1">Cerrar sesi√≥n</p>
  </button>
  }
</div>
<app-mychain [extendedChain]="this.extendedChain" [isOpen]="this.isExtChainOpen"
  [isMyChain]="this.isMyChainModal"></app-mychain>
<ng-container #chatcompoContainer></ng-container>